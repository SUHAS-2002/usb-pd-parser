Universal Serial Bus Power Delivery Specification, Revision 3.2, Version 1.1, 2024-10
Page 281
6.12.2.1.3
  Chunked Tx State Diagram
Figure 6.61, "Chunked Tx State Diagram" shows the state behavior for the Chunked Tx State Machine. This 
recognizes whether Chunked transmitted Messages are involved and deals with sending chunks and waiting for 
chunk requests when they are. It also performs validity checks on all related Messages related to Chunking.
Figure 6.61 Chunked Tx State Diagram
6.12.2.1.3.1
  TCH_Wait_For_Message_Request_From_Policy_Engine State
The Chunked Tx State Machine Shall enter the TCH_Wait_For_Message_Request_From_Policy_Engine state:

At startup.

As a result of a Soft Reset occurring.

On exit from a Hard Reset. 
On entry to the TCH_Wait_For_Message_Request_From_Policy_Engine state the Chunked Tx state machine clears 
the Optional Abort Flag.
In the TCH_Wait_For_Message_Request_From_Policy_Engine state the Chunked Tx State Machine waits until the 
Policy Engine sends it a Message Request.
The Chunked Tx State Machine Shall transition to the TCH_Pass_Down_Message state when: 

A non-Extended Message Request is received from the Policy Engine, or

A Message Request is received from the Policy Engine and the link is not Chunking.
TCH_Sending_
Chunked_Message
Actions on entry:
TCH_ Wait_ For_Message_Request_From_Policy_Engine
Actions on entry:
Clear Abort Flag
TCH_Pass_Down_Message
Actions on entry:
Pass Message to Protocol Layer
TCH_Construct_
Chunked_Message
Actions on entry:
Construct Message Chunk and pass 
to Protocol Layer
TCH_Wait_For_
Transmision_Complete
Actions on entry:
TCH_Prepare_To_Send_
Chunked_Message  
Actions on entry:
'Chunk Number To Send' = 0
TCH_Wait_Chunk_Request
Actions on entry:
Increment Chunk Number to Send
Start ChunkSenderRequestTimer
TCH_Report_Error
Actions on entry:
Report Error to Policy Engine
Soft Reset occured |
Exit from Hard Reset
Start
Non-Extended Message Request |
Not Chunking  
Message
Passed
Message Transmitted 
received from 
Protocol Layer
TCH_Message_Sent
Actions on entry:
Inform Policy Engine of Message 
Sent
Any Message Received and 
not in state 
TCH_Wait_Chunk_Request
Chunking &
Extended Message Request  
Chunk Number Set
Chunk
Passed
Message Transmitted 
from Protocol Layer & 
Not Last Chunk
TCH_Message_Received
Actions on entry:
Clear Extended Message Buffers
Pass Message to Chunked Rx
Message passed 
to Chunked Rx
Message Transmitted 
received from Protocol Layer & 
Last Chunk
(Rx Chunking
State != 
RCH_Wait_For_
Message_From_
Protocol_Layer) &
Abort  Supported
Abort Flag Set
Informed
Chunk Request Rcvd &
Chunk Number = 
Chunk Number to Send
Reported
Other 
Message
 Received
(Rx Chunking
State != 
RCH_Wait_For_
Message_From_
Protocol_Layer) &
Abort Not Supported
Tx Error from
Protocol Layer
ChunkSenderRequestTimer
timeout & Chunk Number = 0
(Chunk Request Rcvd &
Chunk Number != 
Chunk Number to Send) |
(ChunkSenderRequestTimer
timeout & Chunk Number > 0)
Transmission
Error
